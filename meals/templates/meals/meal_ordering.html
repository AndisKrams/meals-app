{% extends 'base.html' %}
{% block content %}
<h2>Order Meals</h2>
<form method="get" class="mb-3" aria-label="Select date">
  <label for="date" class="form-label">Select date:</label>
  <select name="date" id="date" class="form-select" onchange="this.form.submit()">
    {% for date in available_dates %}
      {% with formatted_date=date|date:'Y-m-d' %}
        <option value="{{ formatted_date }}" {% if formatted_date == selected_date %}selected{% endif %}>
          {{ date|date:'M j, Y' }}
        </option>
      {% endwith %}
    {% endfor %}
  </select>
</form>

{% if meal_registration %}
  <form method="post" novalidate>
    {% csrf_token %}
    {% for child, form in forms %}
      <fieldset class="mb-3" aria-labelledby="legend-child-{{ child.id }}">
        <legend id="legend-child-{{ child.id }}">{{ child.first_name }} {{ child.last_name }} â€” Year {{ child.year_group }}</legend>
        {% if form.non_field_errors %}
          <div class="alert alert-danger" role="alert">{{ form.non_field_errors }}</div>
        {% endif %}
        {{ form.meal.errors }}
        {{ form.meal }}
      </fieldset>
    {% endfor %}
    <button class="btn btn-success" type="submit">Save choices</button>
  </form>
{% else %}
  <p>No meals registered for this date.</p>
{% endif %}
{% endblock %}