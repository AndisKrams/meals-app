{% extends "admin/base.html" %}

{% block content %}
  <h1>{{ title }}</h1>

  {% if available_dates %}
    <form method="get" action="{% url 'admin:meals-for-day' %}" style="margin-bottom: 2rem;">
      <label for="date">Select Date:</label>
      <select id="date" name="date" onchange="this.form.submit()">
        {% for d in available_dates %}
          <option value="{{ d|date:'Y-m-d' }}" {% if d == date %}selected{% endif %}>
            {{ d|date:"D, M j, Y" }}
          </option>
        {% endfor %}
      </select>
      <noscript>
        <button type="submit">Go</button>
      </noscript>
    </form>
  {% else %}
    <p><strong>No meal registrations with orders found.</strong> Orders will appear here once parents submit meal choices.</p>
  {% endif %}

  {% if meals %}
    <h2>Meal Choice Totals</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Meal Choice</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for total in meal_totals %}
        <tr>
          <td>{{ total.meal__name }}</td>
          <td>{{ total.total }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <h2>Individual Meal Choices</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Year Group</th>
          <th>Last Name</th>
          <th>First Name</th>
          <th>Meal Choice</th>
          <th>Meal Registration Date</th>
        </tr>
      </thead>
      <tbody>
        {% for meal in meals %}
        <tr>
          <td>{{ meal.child.year_group }}</td>
          <td>{{ meal.child.last_name }}</td>
          <td>{{ meal.child.first_name }}</td>
          <td>{{ meal.meal.name }}</td>
          <td>{{ meal.meal_registration.date }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No meal choices available for the selected date.</p>
  {% endif %}
{% endblock %}